<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigrani - Building & Infrastructure Complaint Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Animations */
        .fade-in { animation: fadeIn 200ms ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up { animation: slideUp 200ms ease-out; }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        /* Button interactions */
        .tap-scale { 
            transition: all 120ms ease-out; 
            transform-origin: center;
        }
        .tap-scale:hover { 
            transform: scale(1.05); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .tap-scale:active { transform: scale(0.98); }
        
        /* Card hover effects */
        .card-hover {
            transition: all 200ms ease-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        /* Gradient backgrounds */
        .gradient-primary { background: linear-gradient(135deg, #0B4D8F 0%, #3B82F6 100%); }
        .gradient-success { background: linear-gradient(135deg, #16A34A 0%, #10B981 100%); }
        .gradient-danger { background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%); }
        .gradient-warning { background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%); }
        .gradient-logo { background: linear-gradient(135deg, #16A34A 0%, #10B981 100%); }
        
        /* Glow effects */
        .glow-green:hover { box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
        .glow-blue:hover { box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        .glow-red:hover { box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }
        
        /* Toast animation */
        .toast { animation: toast 2s ease-in-out; }
        @keyframes toast {
            0%, 100% { opacity: 0; transform: translateY(-20px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }
        
        /* Status badges */
        .status-pending { background: #DC2626; color: white; }
        .status-progress { background: #F59E0B; color: white; }
        .status-resolved { background: #16A34A; color: white; }
        
        /* Table row hover */
        .table-row:hover { background: rgba(59, 130, 246, 0.05); }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }
        
        /* Custom shadows */
        .shadow-soft { box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .shadow-card { box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
        
        /* Image preview */
        .image-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        /* Form focus effects */
        .form-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Eye icon animation */
        .eye-blink { animation: blink 3s infinite; }
        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0B4D8F',
                        success: '#16A34A',
                        warning: '#F59E0B',
                        danger: '#DC2626'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Start Screen -->
    <div id="startScreen" class="min-h-screen bg-gradient-to-br from-slate-100 to-blue-50 flex flex-col justify-center items-center p-6">
        <div class="bg-white rounded-2xl shadow-card p-8 w-full max-w-md fade-in">
            <!-- Logo -->
            <div class="text-center mb-8">
                <div class="gradient-logo w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-soft eye-blink">
                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-3">Nigrani</h1>
                <p class="text-gray-600 mb-2">Building & Infrastructure Complaint Tracker</p>
                <p class="text-sm text-gray-500">Demo project by Team Falcon </p>
            </div>
            
            <div class="space-y-4">
                <button onclick="loginAsUser()" class="tap-scale glow-blue w-full gradient-primary text-white font-semibold py-4 px-6 rounded-2xl transition duration-200 flex items-center justify-center space-x-3 shadow-soft">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                    <span>Login as User</span>
                </button>
                
                <button onclick="loginAsAdmin()" class="tap-scale glow-green w-full gradient-success text-white font-semibold py-4 px-6 rounded-2xl transition duration-200 flex items-center justify-center space-x-3 shadow-soft">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"/>
                    </svg>
                    <span>Login as Admin</span>
                </button>
            </div>
        </div>
    </div>

    <!-- User Home Screen -->
    <div id="userHomeScreen" class="hidden min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
        <div class="gradient-primary text-white p-6 rounded-b-3xl shadow-soft">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-2xl font-bold">Welcome, Citizen</h2>
                    <p class="text-blue-100">Report infrastructure issues in your area</p>
                </div>
                <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-xl text-sm font-medium tap-scale">
                    Logout
                </button>
            </div>
        </div>
        
        <div class="p-6 space-y-6">
            <div class="grid grid-cols-1 gap-6">
                <button onclick="showSubmitForm()" class="tap-scale card-hover gradient-warning text-white rounded-2xl p-8 shadow-card glow-blue">
                    <div class="flex items-center space-x-6">
                        <div class="bg-white bg-opacity-20 p-4 rounded-2xl">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <h3 class="text-xl font-bold mb-2">Submit New Complaint</h3>
                            <p class="text-orange-100">Report infrastructure issues and get them resolved</p>
                        </div>
                    </div>
                </button>
                
                <button onclick="showTrackComplaint()" class="tap-scale card-hover gradient-primary text-white rounded-2xl p-8 shadow-card glow-green">
                    <div class="flex items-center space-x-6">
                        <div class="bg-white bg-opacity-20 p-4 rounded-2xl">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <h3 class="text-xl font-bold mb-2">Track My Complaint</h3>
                            <p class="text-blue-100">Check the status of your submitted complaints</p>
                        </div>
                    </div>
                </button>
            </div>
            
            <div class="bg-white rounded-2xl p-6 shadow-card card-hover">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Updates</h3>
                <div class="space-y-4">
                    <div class="flex items-center space-x-4 p-4 bg-green-50 rounded-xl">
                        <div class="w-4 h-4 bg-success rounded-full"></div>
                        <div>
                            <p class="font-medium text-gray-800">NIG-2025-130011 Resolved</p>
                            <p class="text-sm text-gray-600">Streetlight issue has been fixed</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 p-4 bg-blue-50 rounded-xl">
                        <div class="w-4 h-4 bg-primary rounded-full"></div>
                        <div>
                            <p class="font-medium text-gray-800">NIG-2025-118902 In Progress</p>
                            <p class="text-sm text-gray-600">Waterlogging work has started</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center p-6 text-gray-500 text-sm">
            Demo project by @md.ismaiiil
        </div>
    </div>

    <!-- Submit Complaint Form -->
    <div id="submitFormScreen" class="hidden min-h-screen bg-gradient-to-br from-slate-50 to-orange-50">
        <div class="gradient-warning text-white p-6 rounded-b-3xl shadow-soft">
            <div class="flex items-center space-x-4">
                <button onclick="showUserHome()" class="p-2 hover:bg-white hover:bg-opacity-20 rounded-xl tap-scale">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
                <h2 class="text-2xl font-bold">Submit Complaint</h2>
            </div>
        </div>
        
        <div class="p-6">
            <form id="complaintForm" class="space-y-6">
                <div class="bg-white rounded-2xl p-6 shadow-card space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Full Name</label>
                        <input type="text" id="fullName" class="form-input w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-warning transition duration-200" placeholder="Enter your full name" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Contact Number</label>
                        <input type="number" id="contactNumber" class="form-input w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-warning transition duration-200" placeholder="Enter dummy 5-digit number" maxlength="5" required>
                        <p id="contactError" class="hidden text-red-500 text-sm mt-2">Please enter exactly 5 digits</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Zone</label>
                            <select id="zone" class="form-input w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-warning transition duration-200" required onchange="updateLocalities()">
                                <option value="">Select Zone</option>
                                <option value="Zone 1">Zone 1</option>
                                <option value="Zone 2">Zone 2</option>
                                <option value="Zone 3">Zone 3</option>
                                <option value="Zone 4">Zone 4</option>
                                <option value="Zone 5">Zone 5</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Locality</label>
                            <select id="locality" class="form-input w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-warning transition duration-200" required disabled>
                                <option value="">Select Zone first</option>
                            </select>
                        </div>
                    </div>
                    

                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Complaint Category</label>
                        <select id="category" class="form-input w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-warning transition duration-200" required>
                            <option value="">Select Category</option>
                            <option value="Waterlogging">Waterlogging</option>
                            <option value="Broken Roads">Broken Roads</option>
                            <option value="Drainage Issue">Drainage Issue</option>
                            <option value="Illegal Construction">Illegal Construction</option>
                            <option value="Building Cracks">Building Cracks</option>
                            <option value="Streetlight Issue">Streetlight Issue</option>
                            <option value="Garbage Dump">Garbage Dump</option>
                            <option value="Noise Pollution">Noise Pollution</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Description</label>
                        <textarea id="description" rows="4" class="form-input w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-warning transition duration-200 shadow-soft" placeholder="Describe the issue in detail..." required></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Upload Image</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-warning transition duration-200 glow-blue">
                            <svg class="w-10 h-10 text-gray-400 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                            </svg>
                            <p class="text-gray-600 mb-3">Camera / Gallery</p>
                            <input type="file" id="imageUpload" accept="image/*" class="hidden" onchange="previewImage(this)">
                            <button type="button" onclick="document.getElementById('imageUpload').click()" class="gradient-warning text-white px-6 py-3 rounded-xl font-medium tap-scale">
                                Choose Image
                            </button>
                            <div id="imagePreview" class="hidden mt-4">
                                <img id="previewImg" class="image-preview mx-auto shadow-soft">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button type="button" onclick="saveDraft()" class="tap-scale flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-4 px-6 rounded-xl transition duration-200">
                        Save Draft
                    </button>
                    <button type="submit" class="tap-scale flex-1 gradient-success text-white font-semibold py-4 px-6 rounded-xl transition duration-200 glow-green">
                        Submit Complaint
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Screen -->
    <div id="successScreen" class="hidden min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 flex flex-col justify-center items-center p-6">
        <div class="bg-white rounded-2xl shadow-card p-8 w-full max-w-md text-center slide-up">
            <div class="gradient-success w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-3">âœ… Complaint Submitted Successfully</h3>
            <p class="text-gray-600 mb-6">Your complaint has been registered and will be reviewed soon</p>
            <div class="bg-gray-50 p-6 rounded-xl mb-6">
                <p class="text-sm text-gray-600 mb-2">Tracker ID:</p>
                <p id="generatedTrackerId" class="text-xl font-bold text-primary"></p>
            </div>
            <div class="space-y-3">
                <button onclick="showUserHome()" class="tap-scale w-full gradient-primary text-white font-semibold py-4 px-6 rounded-xl transition duration-200 glow-blue">
                    Go Home
                </button>
                <button onclick="showTrackComplaint()" class="tap-scale w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-4 px-6 rounded-xl transition duration-200">
                    Track This Complaint
                </button>
            </div>
        </div>
    </div>

    <!-- Track Complaint Screen -->
    <div id="trackComplaintScreen" class="hidden min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
        <div class="gradient-primary text-white p-6 rounded-b-3xl shadow-soft">
            <div class="flex items-center space-x-4">
                <button onclick="showUserHome()" class="p-2 hover:bg-white hover:bg-opacity-20 rounded-xl tap-scale">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
                <h2 class="text-2xl font-bold">Track Complaint</h2>
            </div>
        </div>
        
        <div class="p-6 space-y-6">
            <div class="bg-white rounded-2xl p-6 shadow-card">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Enter Tracker ID</label>
                <div class="flex space-x-3">
                    <input type="text" id="trackerIdInput" class="form-input flex-1 p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-primary transition duration-200" placeholder="e.g., NIG-2025-102314">
                    <button onclick="trackComplaint()" class="tap-scale gradient-success text-white px-8 py-4 rounded-xl font-semibold glow-green">
                        Check Status
                    </button>
                </div>
            </div>
            
            <div id="trackingResult" class="hidden bg-white rounded-2xl p-6 shadow-card fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold text-gray-800">Complaint Details</h3>
                    <div class="flex items-center space-x-3">
                        <span id="statusBadge" class="px-4 py-2 rounded-full text-sm font-semibold"></span>
                        <span id="slaBadge" class="hidden px-3 py-1 rounded-full text-xs font-semibold text-white"></span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600 font-medium">Tracker ID:</span>
                            <span id="displayTrackerId" class="font-semibold"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 font-medium">Zone:</span>
                            <span id="displayZone" class="font-semibold"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 font-medium">Locality:</span>
                            <span id="displayLocality" class="font-semibold"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 font-medium">Category:</span>
                            <span id="displayCategory" class="font-semibold"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 font-medium">Date Submitted:</span>
                            <span id="displayDate" class="font-semibold"></span>
                        </div>
                    </div>
                    
                    <div id="uploadedImage" class="hidden">
                        <h4 class="font-semibold text-gray-800 mb-3">Uploaded Image</h4>
                        <div class="bg-gray-100 rounded-xl p-6 text-center">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                            </svg>
                            <p class="text-gray-500">Image thumbnail preview</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-800 mb-4">Status Timeline</h4>
                    <div id="statusTimeline" class="space-y-4"></div>
                </div>
                
                <div id="adminComments" class="hidden">
                    <h4 class="font-semibold text-gray-800 mb-3">Admin Comments</h4>
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <p id="adminCommentsText" class="text-gray-700"></p>
                    </div>
                </div>
            </div>
            
            <div id="trackingError" class="hidden bg-red-50 border-2 border-red-200 rounded-2xl p-8 text-center">
                <svg class="w-16 h-16 text-red-400 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                <h3 class="text-lg font-bold text-red-800 mb-2">Tracker ID Not Found</h3>
                <p class="text-red-600">We could not find that Tracker ID. Please check and try again.</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen bg-gradient-to-br from-slate-50 to-green-50">
        <div class="gradient-success text-white p-6 rounded-b-3xl shadow-soft">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-2xl font-bold">Admin Dashboard</h2>
                    <p class="text-green-100">Infrastructure Management System</p>
                </div>
                <div class="flex space-x-3">
                    <button onclick="exportCSV()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-xl text-sm font-medium tap-scale">
                        Export CSV
                    </button>
                    <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-xl text-sm font-medium tap-scale">
                        Logout
                    </button>
                </div>
            </div>
        </div>
        
        <div class="p-6 space-y-6">
            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-2xl p-6 shadow-card card-hover border-l-4 border-primary">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 font-medium mb-1">Total Complaints</p>
                            <p id="totalComplaints" class="text-3xl font-bold text-gray-800">5</p>
                        </div>
                        <div class="gradient-primary p-4 rounded-2xl">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6h-3a2 2 0 00-2 2v4H6V5z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-card card-hover border-l-4 border-warning">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 font-medium mb-1">Pending</p>
                            <p id="pendingComplaints" class="text-3xl font-bold text-gray-800">3</p>
                        </div>
                        <div class="gradient-warning p-4 rounded-2xl">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-card card-hover border-l-4 border-success">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 font-medium mb-1">Resolved</p>
                            <p id="resolvedComplaints" class="text-3xl font-bold text-gray-800">1</p>
                        </div>
                        <div class="gradient-success p-4 rounded-2xl">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl p-6 shadow-card card-hover">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Complaints by Category</h3>
                    <canvas id="categoryChart" width="400" height="200"></canvas>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-card card-hover">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Status Distribution</h3>
                    <canvas id="statusChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- Complaints Table -->
            <div class="bg-white rounded-2xl shadow-card overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800">Complaints Management</h3>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tracker ID</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Zone</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Category</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="complaintsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Table rows populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Complaint Detail Modal -->
    <div id="complaintDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-screen overflow-y-auto slide-up shadow-card">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Complaint Details</h3>
                    <button onclick="closeComplaintDetail()" class="text-gray-400 hover:text-gray-600 tap-scale p-2">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="p-6 space-y-6">
                <div id="complaintDetailContent">
                    <!-- Content populated by JavaScript -->
                </div>
                
                <div class="border-t pt-6">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">Update Status</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                            <select id="statusUpdate" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-success transition duration-200">
                                <option value="Pending">Pending</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Resolved">Resolved</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Admin Notes</label>
                            <textarea id="adminNotes" rows="4" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-success transition duration-200" placeholder="Add notes or comments..."></textarea>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="updateComplaint()" class="tap-scale flex-1 gradient-success text-white font-semibold py-4 px-6 rounded-xl transition duration-200 glow-green">
                                Save Updates
                            </button>
                            <button onclick="deleteComplaint()" class="tap-scale gradient-danger text-white font-semibold py-4 px-6 rounded-xl transition duration-200 glow-red">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full slide-up shadow-card">
            <div class="text-center">
                <div class="gradient-danger w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6h-3a2 2 0 00-2 2v4H6V5z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-3">Delete Complaint</h3>
                <p class="text-gray-600 mb-6">Are you sure you want to delete this complaint? This action cannot be undone.</p>
                <div class="flex space-x-4">
                    <button onclick="closeDeleteModal()" class="tap-scale flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-xl transition duration-200">
                        Cancel
                    </button>
                    <button onclick="confirmDelete()" class="tap-scale flex-1 gradient-danger text-white font-semibold py-3 px-6 rounded-xl transition duration-200 glow-red">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed top-6 left-1/2 transform -translate-x-1/2 gradient-success text-white px-6 py-4 rounded-xl shadow-card z-50 toast">
        <p id="toastMessage" class="font-medium"></p>
    </div>

    <script>
        // Zone-Locality mapping
        const zoneLocalities = {
            'Zone 1': ['Shivaji Nagar', 'Laxmi Chowk', 'Gandhi Chowk', 'Tilak Nagar', 'Azad Maidan', 'MG Road'],
            'Zone 2': ['Nehru Ward', 'Ambedkar Nagar', 'Saraswati Colony', 'Jawahar Square', 'Market Yard', 'Kranti Chowk'],
            'Zone 3': ['Gokulwadi', 'Ramtek Nagar', 'Hanuman Mandir Road', 'Shastri Chowk', 'RTO Colony', 'Station Road'],
            'Zone 4': ['Pratap Nagar', 'Vivekanand Colony', 'Bhel Chowk', 'City Hospital Area', 'Teachers Colony', 'Police Line'],
            'Zone 5': ['Padmini Enclave', 'Rajendra Nagar', 'Industrial Estate', 'Nala Stop', 'Green Park', 'Canal Road']
        };

        // Data persistence functions
        function saveToLocalStorage() {
            try {
                localStorage.setItem('nigrani_complaints', JSON.stringify(complaints));
                localStorage.setItem('nigrani_draft', JSON.stringify(draftData));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedComplaints = localStorage.getItem('nigrani_complaints');
                const savedDraft = localStorage.getItem('nigrani_draft');
                
                if (savedComplaints) {
                    complaints = JSON.parse(savedComplaints);
                } else {
                    // Initialize with sample data if no saved data exists
                    complaints = [
                        {
                            id: 'NIG-2025-102314',
                            name: 'Rahul Sharma',
                            contact: '98765',
                            zone: 'Zone 1',
                            locality: 'Shivaji Nagar',
                            category: 'Broken Roads',
                            description: 'Large pothole on main road causing traffic issues and vehicle damage',
                            status: 'Pending',
                            date: '2025-01-21',
                            adminNotes: '',
                            image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNzVMMTI1IDUwSDc1TDEwMCA3NVoiIGZpbGw9IiM5Q0EzQUYiLz4KPHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI5MCIgeT0iNjUiPgo8cGF0aCBkPSJNMTAgMTJDMTEuMTA0NiAxMiAxMiAxMS4xMDQ2IDEyIDEwQzEyIDguODk1NDMgMTEuMTA0NiA4IDEwIDhDOC44OTU0MyA4IDggOC44OTU0MyA4IDEwQzggMTEuMTA0NiA4Ljg5NTQzIDEyIDEwIDEyWiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4KPHRleHQgeD0iMTAwIiB5PSIxMjAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzlDQTNBRiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Um9hZCBEYW1hZ2U8L3RleHQ+Cjwvc3ZnPg=='
                        },
                        {
                            id: 'NIG-2025-118902',
                            name: 'Aisha Khan',
                            contact: '87654',
                            zone: 'Zone 3',
                            locality: 'Station Road',
                            category: 'Waterlogging',
                            description: 'Severe water accumulation during rain near railway station area',
                            status: 'In Progress',
                            date: '2025-01-19',
                            adminNotes: 'Drainage team assigned. Cleaning work has started.',
                            image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRUZGNkZGIi8+CjxlbGxpcHNlIGN4PSIxMDAiIGN5PSIxMDAiIHJ4PSI2MCIgcnk9IjIwIiBmaWxsPSIjM0I4MkY2Ii8+CjxlbGxpcHNlIGN4PSI4MCIgY3k9IjkwIiByeD0iMzAiIHJ5PSIxMCIgZmlsbD0iIzYwQTVGQSIvPgo8ZWxsaXBzZSBjeD0iMTIwIiBjeT0iMTEwIiByeD0iMjUiIHJ5PSI4IiBmaWxsPSIjNjBBNUZBIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMzAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzlDQTNBRiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+V2F0ZXJsb2dnaW5nPC90ZXh0Pgo8L3N2Zz4='
                        },
                        {
                            id: 'NIG-2025-127644',
                            name: 'Omkar Patil',
                            contact: '76543',
                            zone: 'Zone 2',
                            locality: 'Market Yard',
                            category: 'Drainage Issue',
                            description: 'Blocked drain causing bad smell and unhygienic conditions',
                            status: 'Pending',
                            date: '2025-01-20',
                            adminNotes: '',
                            image: null
                        },
                        {
                            id: 'NIG-2025-130011',
                            name: 'Neeraj Kulkarni',
                            contact: '65432',
                            zone: 'Zone 5',
                            locality: 'Industrial Estate',
                            category: 'Streetlight Issue',
                            description: 'Multiple street lights not working for past 3 days',
                            status: 'Resolved',
                            date: '2025-01-15',
                            adminNotes: 'Electrician team dispatched. All lights repaired and tested successfully.',
                            image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjMUYyOTM3Ii8+CjxyZWN0IHg9Ijk1IiB5PSIyMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjNkI3Mjg0Ii8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjQwIiByPSIxNSIgZmlsbD0iI0Y1OUUwQiIvPgo8Y2lyY2xlIGN4PSIxMDAiIGN5PSI0MCIgcj0iMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0Y1OUUwQiIgc3Ryb2tlLXdpZHRoPSIyIiBvcGFjaXR5PSIwLjUiLz4KPHN2ZyB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI5NSIgeT0iMzUiPgo8cGF0aCBkPSJNNSAyTDYgNEg0TDUgMloiIGZpbGw9IiNGRkZGRkYiLz4KPC9zdmc+Cjx0ZXh0IHg9IjEwMCIgeT0iMTMwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5Q0EzQUYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlN0cmVldGxpZ2h0PC90ZXh0Pgo8L3N2Zz4='
                        },
                        {
                            id: 'NIG-2025-140587',
                            name: 'Pooja Desai',
                            contact: '54321',
                            zone: 'Zone 4',
                            locality: 'City Hospital Area',
                            category: 'Building Cracks',
                            description: 'Visible cracks appearing on residential building wall',
                            status: 'Pending',
                            date: '2025-01-18',
                            adminNotes: '',
                            image: null
                        }
                    ];
                    saveToLocalStorage(); // Save initial data
                }
                
                if (savedDraft) {
                    draftData = JSON.parse(savedDraft);
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                // Initialize with empty data if there's an error
                complaints = [];
                draftData = {};
            }
        }

        // Initialize data
        let complaints = [];
        let draftData = {};
        let currentComplaint = null;

        // Navigation functions
        function loginAsUser() {
            hideAllScreens();
            document.getElementById('userHomeScreen').classList.remove('hidden');
        }

        function loginAsAdmin() {
            hideAllScreens();
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadAdminDashboard();
        }

        function logout() {
            hideAllScreens();
            document.getElementById('startScreen').classList.remove('hidden');
        }

        function showUserHome() {
            hideAllScreens();
            document.getElementById('userHomeScreen').classList.remove('hidden');
        }

        function showSubmitForm() {
            hideAllScreens();
            document.getElementById('submitFormScreen').classList.remove('hidden');
            loadDraft();
        }

        function showTrackComplaint() {
            hideAllScreens();
            document.getElementById('trackComplaintScreen').classList.remove('hidden');
            document.getElementById('trackingResult').classList.add('hidden');
            document.getElementById('trackingError').classList.add('hidden');
        }

        function hideAllScreens() {
            const screens = ['startScreen', 'userHomeScreen', 'submitFormScreen', 'successScreen', 'trackComplaintScreen', 'adminDashboard'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // Update localities based on selected zone
        function updateLocalities() {
            const zoneSelect = document.getElementById('zone');
            const localitySelect = document.getElementById('locality');
            const selectedZone = zoneSelect.value;
            
            localitySelect.innerHTML = '<option value="">Select Locality</option>';
            
            if (selectedZone && zoneLocalities[selectedZone]) {
                localitySelect.disabled = false;
                zoneLocalities[selectedZone].forEach(locality => {
                    const option = document.createElement('option');
                    option.value = locality;
                    option.textContent = locality;
                    localitySelect.appendChild(option);
                });
            } else {
                localitySelect.disabled = true;
            }
        }

        // Contact number validation
        document.getElementById('contactNumber').addEventListener('input', function(e) {
            const value = e.target.value;
            const errorElement = document.getElementById('contactError');
            
            if (value.length > 5) {
                e.target.value = value.slice(0, 5);
            }
            
            if (value.length > 0 && value.length !== 5) {
                errorElement.classList.remove('hidden');
            } else {
                errorElement.classList.add('hidden');
            }
        });

        // Image preview function
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    
                    // Store image data for the complaint
                    const imageData = e.target.result;
                    // We'll add this to the form data when submitting
                    document.getElementById('complaintForm').setAttribute('data-image', imageData);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Save draft function
        function saveDraft() {
            draftData = {
                fullName: document.getElementById('fullName').value,
                contactNumber: document.getElementById('contactNumber').value,
                zone: document.getElementById('zone').value,
                locality: document.getElementById('locality').value,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value
            };
            saveToLocalStorage(); // Save to localStorage
            showToast('Draft saved successfully!');
        }

        // Load draft function
        function loadDraft() {
            if (Object.keys(draftData).length > 0) {
                document.getElementById('fullName').value = draftData.fullName || '';
                document.getElementById('contactNumber').value = draftData.contactNumber || '';
                document.getElementById('zone').value = draftData.zone || '';
                document.getElementById('locality').value = draftData.locality || '';
                document.getElementById('category').value = draftData.category || '';
                document.getElementById('description').value = draftData.description || '';
                
                if (draftData.zone) {
                    updateLocalities();
                    setTimeout(() => {
                        document.getElementById('locality').value = draftData.locality || '';
                    }, 100);
                }
            }
        }

        // Complaint submission
        document.getElementById('complaintForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const contactNumber = document.getElementById('contactNumber').value;
            if (contactNumber.length !== 5) {
                document.getElementById('contactError').classList.remove('hidden');
                return;
            }
            
            const formData = {
                name: document.getElementById('fullName').value,
                contact: contactNumber,
                zone: document.getElementById('zone').value,
                locality: document.getElementById('locality').value,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value
            };

            // Check for duplicate complaints (within 48 hours)
            const now = new Date();
            const twoDaysAgo = new Date(now.getTime() - (48 * 60 * 60 * 1000));
            
            const duplicate = complaints.find(c => 
                c.zone === formData.zone && 
                c.locality === formData.locality && 
                c.category === formData.category &&
                new Date(c.date) > twoDaysAgo
            );
            
            if (duplicate) {
                showToast('âš ï¸ Similar complaint found within 48 hours: ' + duplicate.id);
            }

            // Generate tracker ID
            const trackerId = 'NIG-2025-' + String(Math.floor(Math.random() * 900000) + 100000);
            
            // Get image data if uploaded
            const imageData = document.getElementById('complaintForm').getAttribute('data-image');
            
            // Add to complaints array
            complaints.push({
                id: trackerId,
                name: formData.name,
                contact: formData.contact,
                zone: formData.zone,
                locality: formData.locality,
                category: formData.category,
                description: formData.description,
                status: 'Pending',
                date: new Date().toISOString().split('T')[0],
                adminNotes: '',
                image: imageData || null
            });

            // Clear draft and save to localStorage
            draftData = {};
            saveToLocalStorage();

            // Show success screen
            document.getElementById('generatedTrackerId').textContent = trackerId;
            hideAllScreens();
            document.getElementById('successScreen').classList.remove('hidden');
            
            // Reset form
            document.getElementById('complaintForm').reset();
            document.getElementById('complaintForm').removeAttribute('data-image');
            document.getElementById('locality').disabled = true;
            document.getElementById('locality').innerHTML = '<option value="">Select Zone first</option>';
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('contactError').classList.add('hidden');
        });

        // Complaint tracking
        function trackComplaint() {
            const trackerId = document.getElementById('trackerIdInput').value.trim().toUpperCase();
            const complaint = complaints.find(c => c.id === trackerId);
            
            document.getElementById('trackingResult').classList.add('hidden');
            document.getElementById('trackingError').classList.add('hidden');
            
            if (complaint) {
                displayComplaintStatus(complaint);
            } else {
                document.getElementById('trackingError').classList.remove('hidden');
            }
        }

        function displayComplaintStatus(complaint) {
            document.getElementById('trackingResult').classList.remove('hidden');
            document.getElementById('displayTrackerId').textContent = complaint.id;
            document.getElementById('displayZone').textContent = complaint.zone;
            document.getElementById('displayLocality').textContent = complaint.locality;
            document.getElementById('displayCategory').textContent = complaint.category;
            document.getElementById('displayDate').textContent = new Date(complaint.date).toLocaleDateString();
            
            // Status badge
            const statusBadge = document.getElementById('statusBadge');
            statusBadge.textContent = complaint.status;
            
            if (complaint.status === 'Pending') {
                statusBadge.className = 'status-pending px-4 py-2 rounded-full text-sm font-semibold';
            } else if (complaint.status === 'In Progress') {
                statusBadge.className = 'status-progress px-4 py-2 rounded-full text-sm font-semibold';
            } else if (complaint.status === 'Resolved') {
                statusBadge.className = 'status-resolved px-4 py-2 rounded-full text-sm font-semibold';
            }
            
            // SLA Badge
            const slaBadge = document.getElementById('slaBadge');
            const daysSince = Math.floor((new Date() - new Date(complaint.date)) / (1000 * 60 * 60 * 24));
            
            if (complaint.status !== 'Resolved') {
                slaBadge.classList.remove('hidden');
                if (daysSince >= 14) {
                    slaBadge.className = 'px-3 py-1 rounded-full text-xs font-semibold text-white bg-red-500';
                    slaBadge.textContent = `${daysSince} days`;
                } else if (daysSince >= 7) {
                    slaBadge.className = 'px-3 py-1 rounded-full text-xs font-semibold text-white bg-yellow-500';
                    slaBadge.textContent = `${daysSince} days`;
                } else {
                    slaBadge.classList.add('hidden');
                }
            } else {
                slaBadge.classList.add('hidden');
            }
            
            // Status timeline
            const timeline = document.getElementById('statusTimeline');
            timeline.innerHTML = '';
            
            const statuses = ['Pending', 'In Progress', 'Resolved'];
            const currentIndex = statuses.indexOf(complaint.status);
            
            statuses.forEach((status, index) => {
                const isActive = index <= currentIndex;
                const timelineItem = document.createElement('div');
                timelineItem.className = 'flex items-center space-x-4';
                timelineItem.innerHTML = `
                    <div class="w-4 h-4 rounded-full ${isActive ? 'bg-success' : 'bg-gray-300'}"></div>
                    <span class="font-medium ${isActive ? 'text-gray-800' : 'text-gray-500'}">${status}</span>
                `;
                timeline.appendChild(timelineItem);
            });
            
            // Show uploaded image
            const uploadedImageDiv = document.getElementById('uploadedImage');
            if (complaint.image) {
                uploadedImageDiv.classList.remove('hidden');
                uploadedImageDiv.innerHTML = `
                    <h4 class="font-semibold text-gray-800 mb-3">Uploaded Image</h4>
                    <div class="bg-gray-100 rounded-xl p-4 text-center">
                        <img src="${complaint.image}" alt="Complaint Image" class="max-w-full max-h-32 mx-auto rounded-lg shadow-soft object-cover">
                    </div>
                `;
            } else {
                uploadedImageDiv.classList.add('hidden');
            }
            
            // Admin comments
            if (complaint.adminNotes) {
                document.getElementById('adminComments').classList.remove('hidden');
                document.getElementById('adminCommentsText').textContent = complaint.adminNotes;
            } else {
                document.getElementById('adminComments').classList.add('hidden');
            }
        }

        // Admin dashboard functions
        function loadAdminDashboard() {
            updateKPIs();
            loadComplaintsTable();
            loadCharts();
        }

        function updateKPIs() {
            const total = complaints.length;
            const pending = complaints.filter(c => c.status === 'Pending').length;
            const inProgress = complaints.filter(c => c.status === 'In Progress').length;
            const resolved = complaints.filter(c => c.status === 'Resolved').length;
            
            document.getElementById('totalComplaints').textContent = total;
            document.getElementById('pendingComplaints').textContent = pending;
            document.getElementById('resolvedComplaints').textContent = resolved;
        }

        function loadComplaintsTable() {
            const tbody = document.getElementById('complaintsTableBody');
            tbody.innerHTML = '';
            
            complaints.forEach(complaint => {
                const row = document.createElement('tr');
                row.className = 'table-row transition duration-200';
                
                let statusClass = '';
                if (complaint.status === 'Pending') statusClass = 'status-pending';
                else if (complaint.status === 'In Progress') statusClass = 'status-progress';
                else if (complaint.status === 'Resolved') statusClass = 'status-resolved';
                
                // Calculate SLA
                const daysSince = Math.floor((new Date() - new Date(complaint.date)) / (1000 * 60 * 60 * 24));
                let slaIndicator = '';
                if (complaint.status !== 'Resolved') {
                    if (daysSince >= 14) {
                        slaIndicator = '<span class="inline-block w-3 h-3 bg-red-500 rounded-full ml-2"></span>';
                    } else if (daysSince >= 7) {
                        slaIndicator = '<span class="inline-block w-3 h-3 bg-yellow-500 rounded-full ml-2"></span>';
                    }
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 font-semibold text-gray-900">${complaint.id}</td>
                    <td class="px-6 py-4 text-gray-900">${complaint.name}</td>
                    <td class="px-6 py-4 text-gray-900">${complaint.zone}</td>
                    <td class="px-6 py-4 text-gray-900">${complaint.category}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${statusClass}">${complaint.status}</span>
                        ${slaIndicator}
                    </td>
                    <td class="px-6 py-4 text-gray-900">${new Date(complaint.date).toLocaleDateString()}</td>
                    <td class="px-6 py-4 space-x-3">
                        <button onclick="openComplaintDetail('${complaint.id}')" class="text-primary hover:text-blue-800 font-semibold tap-scale">View</button>
                        <button onclick="markResolved('${complaint.id}')" class="text-success hover:text-green-800 font-semibold tap-scale">Resolve</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function openComplaintDetail(complaintId) {
            const complaint = complaints.find(c => c.id === complaintId);
            if (!complaint) return;
            
            currentComplaint = complaint;
            const modal = document.getElementById('complaintDetailModal');
            const content = document.getElementById('complaintDetailContent');
            
            content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-lg font-bold text-gray-800 mb-4">Complaint Information</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Tracker ID:</span>
                                <span class="font-semibold">${complaint.id}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Name:</span>
                                <span class="font-semibold">${complaint.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Contact:</span>
                                <span class="font-semibold">${complaint.contact}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Zone:</span>
                                <span class="font-semibold">${complaint.zone}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Locality:</span>
                                <span class="font-semibold">${complaint.locality}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Category:</span>
                                <span class="font-semibold">${complaint.category}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 font-medium">Date:</span>
                                <span class="font-semibold">${new Date(complaint.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold text-gray-800 mb-4">Description</h4>
                        <p class="text-gray-700 bg-gray-50 p-4 rounded-xl mb-6">${complaint.description}</p>
                        <h4 class="text-lg font-bold text-gray-800 mb-4">Uploaded Image</h4>
                        <div class="bg-gray-100 rounded-xl p-6 text-center">
                            ${complaint.image ? 
                                `<img src="${complaint.image}" alt="Complaint Image" class="max-w-full max-h-48 mx-auto rounded-lg shadow-soft object-cover">` :
                                `<svg class="w-16 h-16 text-gray-400 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                                </svg>
                                <p class="text-gray-500">No image uploaded</p>`
                            }
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('statusUpdate').value = complaint.status;
            document.getElementById('adminNotes').value = complaint.adminNotes || '';
            
            modal.classList.remove('hidden');
        }

        function closeComplaintDetail() {
            document.getElementById('complaintDetailModal').classList.add('hidden');
            currentComplaint = null;
        }

        function updateComplaint() {
            if (!currentComplaint) return;
            
            const newStatus = document.getElementById('statusUpdate').value;
            const newNotes = document.getElementById('adminNotes').value;
            
            // Update complaint in array
            const complaintIndex = complaints.findIndex(c => c.id === currentComplaint.id);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].status = newStatus;
                complaints[complaintIndex].adminNotes = newNotes;
            }
            
            // Save to localStorage
            saveToLocalStorage();
            
            // Refresh dashboard
            loadAdminDashboard();
            closeComplaintDetail();
            showToast('âœ… Complaint updated successfully!');
        }

        function markResolved(complaintId) {
            const complaintIndex = complaints.findIndex(c => c.id === complaintId);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].status = 'Resolved';
                complaints[complaintIndex].adminNotes = 'Marked as resolved by admin';
                saveToLocalStorage(); // Save to localStorage
                loadAdminDashboard();
                showToast('âœ… Complaint marked as resolved!');
            }
        }

        function deleteComplaint() {
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
        }

        function confirmDelete() {
            if (!currentComplaint) return;
            
            const complaintIndex = complaints.findIndex(c => c.id === currentComplaint.id);
            if (complaintIndex !== -1) {
                complaints.splice(complaintIndex, 1);
                
                // Save to localStorage
                saveToLocalStorage();
                
                // Close modals immediately
                closeDeleteModal();
                closeComplaintDetail();
                
                // Update dashboard immediately
                updateKPIs();
                loadComplaintsTable();
                loadCharts();
                
                showToast('ðŸ—‘ï¸ Complaint deleted successfully!');
            }
        }

        function exportCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Tracker ID,Name,Contact,Zone,Locality,Category,Status,Date,Admin Notes\n"
                + complaints.map(c => 
                    `${c.id},${c.name},${c.contact},${c.zone},${c.locality},${c.category},${c.status},${c.date},"${c.adminNotes}"`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "nigrani_complaints_export.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('ðŸ“Š CSV exported successfully!');
        }

        function loadCharts() {
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            const categoryData = {};
            complaints.forEach(complaint => {
                categoryData[complaint.category] = (categoryData[complaint.category] || 0) + 1;
            });
            
            new Chart(categoryCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        label: 'Complaints',
                        data: Object.values(categoryData),
                        backgroundColor: '#0B4D8F',
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
            
            // Status Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const statusData = {};
            complaints.forEach(complaint => {
                statusData[complaint.status] = (statusData[complaint.status] || 0) + 1;
            });
            
            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusData),
                    datasets: [{
                        data: Object.values(statusData),
                        backgroundColor: ['#DC2626', '#F59E0B', '#16A34A'],
                        borderWidth: 0,
                        cutout: '60%'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 2000);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage first
            loadFromLocalStorage();
            
            hideAllScreens();
            document.getElementById('startScreen').classList.remove('hidden');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972b358083b84162',t:'MTc1NTc5MDYxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>



